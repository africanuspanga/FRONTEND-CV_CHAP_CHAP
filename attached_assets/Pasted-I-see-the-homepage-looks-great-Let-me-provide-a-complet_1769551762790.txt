I see the homepage - looks great! Let me provide a complete auth system with user profiles, CV ownership, and admin foundation.

---

# Complete Auth System for CV Chap Chap

## Architecture Overview

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         CV CHAP CHAP AUTH SYSTEM                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

USER JOURNEY:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

1. ANONYMOUS USER (No Account)
   ‚îú‚îÄ‚îÄ Can create CV (stored with anonymous_id in localStorage)
   ‚îú‚îÄ‚îÄ Can preview all templates
   ‚îú‚îÄ‚îÄ Can pay & download ONE CV
   ‚îî‚îÄ‚îÄ CV is tied to browser (lost if cleared)

2. REGISTERED USER (Has Account)
   ‚îú‚îÄ‚îÄ Can create unlimited CVs
   ‚îú‚îÄ‚îÄ All CVs linked to user_id
   ‚îú‚îÄ‚îÄ Can access CVs from any device
   ‚îú‚îÄ‚îÄ Paid CVs ‚Üí FREE re-downloads forever
   ‚îú‚îÄ‚îÄ Can edit paid CVs anytime
   ‚îî‚îÄ‚îÄ Dashboard shows all their CVs

3. ANONYMOUS ‚Üí REGISTERED (Upgrade)
   ‚îú‚îÄ‚îÄ User signs up after creating CV
   ‚îú‚îÄ‚îÄ Anonymous CV automatically linked to new account
   ‚îî‚îÄ‚îÄ No data loss

4. ADMIN USER (role = 'admin')
   ‚îú‚îÄ‚îÄ Access to /admin dashboard
   ‚îú‚îÄ‚îÄ View all users, CVs, payments
   ‚îú‚îÄ‚îÄ Revenue analytics
   ‚îî‚îÄ‚îÄ User management

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

DATABASE RELATIONSHIPS:

auth.users (Supabase Auth)
    ‚îÇ
    ‚ñº
profiles (1:1)
    ‚îÇ user_id
    ‚ñº
cvs (1:many) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ payments (1:many)
    ‚îÇ                     ‚îÇ
    ‚îî‚îÄ‚îÄ‚ñ∫ Paid CV = User owns it forever
         - Free re-downloads
         - Free re-edits
         - Access from any device
```

---

## Task 1: Update Database Schema

Run this SQL in Supabase SQL Editor:

```sql
-- ============================================
-- CV CHAP CHAP - COMPLETE AUTH SCHEMA
-- Run this to add missing columns/tables
-- ============================================

-- 1. UPDATE PROFILES TABLE (add role for admin)
ALTER TABLE public.profiles 
ADD COLUMN IF NOT EXISTS role TEXT DEFAULT 'user' CHECK (role IN ('user', 'admin')),
ADD COLUMN IF NOT EXISTS avatar_url TEXT,
ADD COLUMN IF NOT EXISTS is_active BOOLEAN DEFAULT true,
ADD COLUMN IF NOT EXISTS last_login TIMESTAMPTZ;

-- 2. UPDATE CVS TABLE (add title and better tracking)
ALTER TABLE public.cvs
ADD COLUMN IF NOT EXISTS title TEXT,
ADD COLUMN IF NOT EXISTS is_deleted BOOLEAN DEFAULT false,
ADD COLUMN IF NOT EXISTS download_count INTEGER DEFAULT 0,
ADD COLUMN IF NOT EXISTS last_downloaded_at TIMESTAMPTZ;

-- 3. CREATE USER_SESSIONS TABLE (for analytics)
CREATE TABLE IF NOT EXISTS public.user_sessions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES public.profiles(id) ON DELETE CASCADE,
  anonymous_id TEXT,
  ip_address TEXT,
  user_agent TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 4. CREATE ADMIN_AUDIT_LOG TABLE (for admin actions)
CREATE TABLE IF NOT EXISTS public.admin_audit_log (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  admin_id UUID REFERENCES public.profiles(id),
  action TEXT NOT NULL,
  target_type TEXT, -- 'user', 'cv', 'payment'
  target_id UUID,
  details JSONB,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 5. UPDATE RLS POLICIES

-- Profiles: Users can read/update their own profile
DROP POLICY IF EXISTS "Users can view own profile" ON public.profiles;
CREATE POLICY "Users can view own profile" ON public.profiles
  FOR SELECT USING (auth.uid() = id);

DROP POLICY IF EXISTS "Users can update own profile" ON public.profiles;
CREATE POLICY "Users can update own profile" ON public.profiles
  FOR UPDATE USING (auth.uid() = id);

-- CVs: Users can CRUD their own CVs
DROP POLICY IF EXISTS "Users can view own CVs" ON public.cvs;
CREATE POLICY "Users can view own CVs" ON public.cvs
  FOR SELECT USING (
    auth.uid() = user_id 
    OR (anonymous_id IS NOT NULL AND anonymous_id = anonymous_id)
  );

DROP POLICY IF EXISTS "Users can insert CVs" ON public.cvs;
CREATE POLICY "Users can insert CVs" ON public.cvs
  FOR INSERT WITH CHECK (true);

DROP POLICY IF EXISTS "Users can update own CVs" ON public.cvs;
CREATE POLICY "Users can update own CVs" ON public.cvs
  FOR UPDATE USING (auth.uid() = user_id);

DROP POLICY IF EXISTS "Users can delete own CVs" ON public.cvs;
CREATE POLICY "Users can delete own CVs" ON public.cvs
  FOR DELETE USING (auth.uid() = user_id);

-- Payments: Users can view their own payments
DROP POLICY IF EXISTS "Users can view own payments" ON public.payments;
CREATE POLICY "Users can view own payments" ON public.payments
  FOR SELECT USING (
    EXISTS (
      SELECT 1 FROM public.cvs 
      WHERE cvs.id = payments.cv_id 
      AND cvs.user_id = auth.uid()
    )
  );

-- Admin policies (admins can see everything)
DROP POLICY IF EXISTS "Admins can view all profiles" ON public.profiles;
CREATE POLICY "Admins can view all profiles" ON public.profiles
  FOR SELECT USING (
    auth.uid() IN (SELECT id FROM public.profiles WHERE role = 'admin')
  );

DROP POLICY IF EXISTS "Admins can view all CVs" ON public.cvs;
CREATE POLICY "Admins can view all CVs" ON public.cvs
  FOR SELECT USING (
    auth.uid() IN (SELECT id FROM public.profiles WHERE role = 'admin')
  );

DROP POLICY IF EXISTS "Admins can view all payments" ON public.payments;
CREATE POLICY "Admins can view all payments" ON public.payments
  FOR SELECT USING (
    auth.uid() IN (SELECT id FROM public.profiles WHERE role = 'admin')
  );

-- 6. FUNCTION: Claim anonymous CVs when user signs up
CREATE OR REPLACE FUNCTION public.claim_anonymous_cvs(p_user_id UUID, p_anonymous_id TEXT)
RETURNS INTEGER AS $$
DECLARE
  claimed_count INTEGER;
BEGIN
  UPDATE public.cvs 
  SET user_id = p_user_id, anonymous_id = NULL
  WHERE anonymous_id = p_anonymous_id AND user_id IS NULL;
  
  GET DIAGNOSTICS claimed_count = ROW_COUNT;
  RETURN claimed_count;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- 7. FUNCTION: Check if user owns a paid CV
CREATE OR REPLACE FUNCTION public.user_owns_cv(p_user_id UUID, p_cv_id UUID)
RETURNS BOOLEAN AS $$
BEGIN
  RETURN EXISTS (
    SELECT 1 FROM public.cvs c
    JOIN public.payments p ON p.cv_id = c.id
    WHERE c.id = p_cv_id 
    AND c.user_id = p_user_id 
    AND p.status = 'completed'
  );
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- 8. INDEX for faster queries
CREATE INDEX IF NOT EXISTS idx_cvs_user_id_status ON public.cvs(user_id, status);
CREATE INDEX IF NOT EXISTS idx_payments_status ON public.payments(status);
CREATE INDEX IF NOT EXISTS idx_profiles_role ON public.profiles(role);
```

---

## Task 2: Auth Context & Provider

Create **`src/lib/auth/context.tsx`**:

```tsx
'use client';

import { createContext, useContext, useEffect, useState, useCallback } from 'react';
import { User, Session } from '@supabase/supabase-js';
import { createClient } from '@/lib/supabase/client';

interface Profile {
  id: string;
  email: string | null;
  full_name: string | null;
  phone: string | null;
  avatar_url: string | null;
  role: 'user' | 'admin';
  created_at: string;
}

interface AuthContextType {
  user: User | null;
  profile: Profile | null;
  session: Session | null;
  isLoading: boolean;
  isAdmin: boolean;
  signUp: (email: string, password: string, fullName: string) => Promise<{ error: Error | null }>;
  signIn: (email: string, password: string) => Promise<{ error: Error | null }>;
  signInWithOTP: (phone: string) => Promise<{ error: Error | null }>;
  verifyOTP: (phone: string, token: string) => Promise<{ error: Error | null }>;
  signOut: () => Promise<void>;
  updateProfile: (updates: Partial<Profile>) => Promise<{ error: Error | null }>;
  claimAnonymousCVs: (anonymousId: string) => Promise<number>;
  refreshProfile: () => Promise<void>;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export function AuthProvider({ children }: { children: React.ReactNode }) {
  const [user, setUser] = useState<User | null>(null);
  const [profile, setProfile] = useState<Profile | null>(null);
  const [session, setSession] = useState<Session | null>(null);
  const [isLoading, setIsLoading] = useState(true);

  const supabase = createClient();

  // Fetch user profile
  const fetchProfile = useCallback(async (userId: string) => {
    const { data, error } = await supabase
      .from('profiles')
      .select('*')
      .eq('id', userId)
      .single();

    if (error) {
      console.error('Error fetching profile:', error);
      return null;
    }
    return data as Profile;
  }, [supabase]);

  // Refresh profile
  const refreshProfile = useCallback(async () => {
    if (user) {
      const profile = await fetchProfile(user.id);
      setProfile(profile);
    }
  }, [user, fetchProfile]);

  // Initialize auth state
  useEffect(() => {
    const initializeAuth = async () => {
      try {
        // Get current session
        const { data: { session } } = await supabase.auth.getSession();
        setSession(session);
        setUser(session?.user ?? null);

        if (session?.user) {
          const profile = await fetchProfile(session.user.id);
          setProfile(profile);

          // Update last login
          await supabase
            .from('profiles')
            .update({ last_login: new Date().toISOString() })
            .eq('id', session.user.id);
        }
      } catch (error) {
        console.error('Auth initialization error:', error);
      } finally {
        setIsLoading(false);
      }
    };

    initializeAuth();

    // Listen for auth changes
    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      async (event, session) => {
        setSession(session);
        setUser(session?.user ?? null);

        if (session?.user) {
          const profile = await fetchProfile(session.user.id);
          setProfile(profile);
        } else {
          setProfile(null);
        }

        if (event === 'SIGNED_OUT') {
          setProfile(null);
        }
      }
    );

    return () => {
      subscription.unsubscribe();
    };
  }, [supabase, fetchProfile]);

  // Sign up with email
  const signUp = async (email: string, password: string, fullName: string) => {
    try {
      const { data, error } = await supabase.auth.signUp({
        email,
        password,
        options: {
          data: {
            full_name: fullName,
          },
        },
      });

      if (error) throw error;

      // Profile is auto-created by trigger, but update full_name
      if (data.user) {
        await supabase
          .from('profiles')
          .update({ full_name: fullName, email })
          .eq('id', data.user.id);
      }

      return { error: null };
    } catch (error) {
      return { error: error as Error };
    }
  };

  // Sign in with email
  const signIn = async (email: string, password: string) => {
    try {
      const { error } = await supabase.auth.signInWithPassword({
        email,
        password,
      });

      if (error) throw error;
      return { error: null };
    } catch (error) {
      return { error: error as Error };
    }
  };

  // Sign in with phone OTP
  const signInWithOTP = async (phone: string) => {
    try {
      const { error } = await supabase.auth.signInWithOtp({
        phone,
      });

      if (error) throw error;
      return { error: null };
    } catch (error) {
      return { error: error as Error };
    }
  };

  // Verify OTP
  const verifyOTP = async (phone: string, token: string) => {
    try {
      const { error } = await supabase.auth.verifyOtp({
        phone,
        token,
        type: 'sms',
      });

      if (error) throw error;
      return { error: null };
    } catch (error) {
      return { error: error as Error };
    }
  };

  // Sign out
  const signOut = async () => {
    await supabase.auth.signOut();
    setUser(null);
    setProfile(null);
    setSession(null);
  };

  // Update profile
  const updateProfile = async (updates: Partial<Profile>) => {
    if (!user) return { error: new Error('Not authenticated') };

    try {
      const { error } = await supabase
        .from('profiles')
        .update(updates)
        .eq('id', user.id);

      if (error) throw error;

      // Refresh profile
      await refreshProfile();
      return { error: null };
    } catch (error) {
      return { error: error as Error };
    }
  };

  // Claim anonymous CVs
  const claimAnonymousCVs = async (anonymousId: string): Promise<number> => {
    if (!user) return 0;

    try {
      const { data, error } = await supabase.rpc('claim_anonymous_cvs', {
        p_user_id: user.id,
        p_anonymous_id: anonymousId,
      });

      if (error) throw error;
      return data || 0;
    } catch (error) {
      console.error('Error claiming CVs:', error);
      return 0;
    }
  };

  const value: AuthContextType = {
    user,
    profile,
    session,
    isLoading,
    isAdmin: profile?.role === 'admin',
    signUp,
    signIn,
    signInWithOTP,
    verifyOTP,
    signOut,
    updateProfile,
    claimAnonymousCVs,
    refreshProfile,
  };

  return (
    <AuthContext.Provider value={value}>
      {children}
    </AuthContext.Provider>
  );
}

export function useAuth() {
  const context = useContext(AuthContext);
  if (context === undefined) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
}
```

---

## Task 3: Auth Pages

### Create **`src/app/auth/login/page.tsx`**:

```tsx
'use client';

import { useState } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import Link from 'next/link';
import { useAuth } from '@/lib/auth/context';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';

export default function LoginPage() {
  const router = useRouter();
  const searchParams = useSearchParams();
  const redirectTo = searchParams.get('redirect') || '/dashboard';
  
  const { signIn, claimAnonymousCVs } = useAuth();
  
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');
  const [isLoading, setIsLoading] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError('');
    setIsLoading(true);

    try {
      const { error } = await signIn(email, password);
      
      if (error) {
        setError(error.message);
        return;
      }

      // Claim any anonymous CVs
      const anonymousId = localStorage.getItem('cv_anonymous_id');
      if (anonymousId) {
        const claimed = await claimAnonymousCVs(anonymousId);
        if (claimed > 0) {
          localStorage.removeItem('cv_anonymous_id');
        }
      }

      router.push(redirectTo);
    } catch (err) {
      setError('An unexpected error occurred');
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-b from-blue-50 to-white flex items-center justify-center p-4">
      <Card className="w-full max-w-md">
        <CardHeader className="text-center">
          <Link href="/" className="inline-flex items-center justify-center gap-2 mb-4">
            <span className="text-2xl">üìÑ</span>
            <span className="text-xl font-bold text-blue-600">CV Chap Chap</span>
          </Link>
          <CardTitle className="text-2xl">Welcome Back</CardTitle>
          <CardDescription>Sign in to access your CVs</CardDescription>
        </CardHeader>

        <CardContent>
          <form onSubmit={handleSubmit} className="space-y-4">
            <div>
              <Label htmlFor="email">Email</Label>
              <Input
                id="email"
                type="email"
                placeholder="you@example.com"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                required
                className="mt-1"
              />
            </div>

            <div>
              <Label htmlFor="password">Password</Label>
              <Input
                id="password"
                type="password"
                placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                required
                className="mt-1"
              />
            </div>

            {error && (
              <div className="p-3 bg-red-50 border border-red-200 rounded-lg">
                <p className="text-sm text-red-600">{error}</p>
              </div>
            )}

            <Button 
              type="submit" 
              className="w-full bg-blue-600 hover:bg-blue-700"
              disabled={isLoading}
            >
              {isLoading ? 'Signing in...' : 'Sign In'}
            </Button>
          </form>

          <div className="mt-6 text-center text-sm">
            <Link href="/auth/forgot-password" className="text-blue-600 hover:underline">
              Forgot password?
            </Link>
          </div>

          <div className="mt-4 text-center text-sm text-gray-600">
            Don't have an account?{' '}
            <Link href={`/auth/register?redirect=${redirectTo}`} className="text-blue-600 hover:underline font-medium">
              Sign up free
            </Link>
          </div>

          <div className="mt-6 pt-6 border-t text-center">
            <Link href="/template" className="text-sm text-gray-500 hover:text-gray-700">
              ‚Üê Continue without account
            </Link>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}
```

---

### Create **`src/app/auth/register/page.tsx`**:

```tsx
'use client';

import { useState } from 'react';
import { useRouter, useSearchParams } from 'next/navigation';
import Link from 'next/link';
import { useAuth } from '@/lib/auth/context';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Card, CardContent, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';

export default function RegisterPage() {
  const router = useRouter();
  const searchParams = useSearchParams();
  const redirectTo = searchParams.get('redirect') || '/dashboard';
  
  const { signUp, claimAnonymousCVs } = useAuth();
  
  const [fullName, setFullName] = useState('');
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [confirmPassword, setConfirmPassword] = useState('');
  const [error, setError] = useState('');
  const [isLoading, setIsLoading] = useState(false);
  const [success, setSuccess] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setError('');

    // Validation
    if (password !== confirmPassword) {
      setError('Passwords do not match');
      return;
    }

    if (password.length < 6) {
      setError('Password must be at least 6 characters');
      return;
    }

    setIsLoading(true);

    try {
      const { error } = await signUp(email, password, fullName);
      
      if (error) {
        setError(error.message);
        return;
      }

      // Claim any anonymous CVs
      const anonymousId = localStorage.getItem('cv_anonymous_id');
      if (anonymousId) {
        const claimed = await claimAnonymousCVs(anonymousId);
        if (claimed > 0) {
          localStorage.removeItem('cv_anonymous_id');
        }
      }

      setSuccess(true);
    } catch (err) {
      setError('An unexpected error occurred');
    } finally {
      setIsLoading(false);
    }
  };

  if (success) {
    return (
      <div className="min-h-screen bg-gradient-to-b from-blue-50 to-white flex items-center justify-center p-4">
        <Card className="w-full max-w-md">
          <CardContent className="pt-6 text-center">
            <div className="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <span className="text-3xl">‚úì</span>
            </div>
            <h2 className="text-2xl font-bold text-gray-900 mb-2">Check Your Email</h2>
            <p className="text-gray-600 mb-6">
              We've sent a confirmation link to <strong>{email}</strong>. 
              Click the link to activate your account.
            </p>
            <Button onClick={() => router.push('/auth/login')} variant="outline" className="w-full">
              Back to Login
            </Button>
          </CardContent>
        </Card>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-b from-blue-50 to-white flex items-center justify-center p-4">
      <Card className="w-full max-w-md">
        <CardHeader className="text-center">
          <Link href="/" className="inline-flex items-center justify-center gap-2 mb-4">
            <span className="text-2xl">üìÑ</span>
            <span className="text-xl font-bold text-blue-600">CV Chap Chap</span>
          </Link>
          <CardTitle className="text-2xl">Create Your Account</CardTitle>
          <CardDescription>Start building your professional CV</CardDescription>
        </CardHeader>

        <CardContent>
          <form onSubmit={handleSubmit} className="space-y-4">
            <div>
              <Label htmlFor="fullName">Full Name</Label>
              <Input
                id="fullName"
                type="text"
                placeholder="John Doe"
                value={fullName}
                onChange={(e) => setFullName(e.target.value)}
                required
                className="mt-1"
              />
            </div>

            <div>
              <Label htmlFor="email">Email</Label>
              <Input
                id="email"
                type="email"
                placeholder="you@example.com"
                value={email}
                onChange={(e) => setEmail(e.target.value)}
                required
                className="mt-1"
              />
            </div>

            <div>
              <Label htmlFor="password">Password</Label>
              <Input
                id="password"
                type="password"
                placeholder="At least 6 characters"
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                required
                className="mt-1"
              />
            </div>

            <div>
              <Label htmlFor="confirmPassword">Confirm Password</Label>
              <Input
                id="confirmPassword"
                type="password"
                placeholder="Repeat your password"
                value={confirmPassword}
                onChange={(e) => setConfirmPassword(e.target.value)}
                required
                className="mt-1"
              />
            </div>

            {error && (
              <div className="p-3 bg-red-50 border border-red-200 rounded-lg">
                <p className="text-sm text-red-600">{error}</p>
              </div>
            )}

            <Button 
              type="submit" 
              className="w-full bg-blue-600 hover:bg-blue-700"
              disabled={isLoading}
            >
              {isLoading ? 'Creating account...' : 'Create Account'}
            </Button>
          </form>

          <p className="mt-4 text-xs text-center text-gray-500">
            By signing up, you agree to our{' '}
            <Link href="/terms" className="text-blue-600 hover:underline">Terms</Link>
            {' '}and{' '}
            <Link href="/privacy" className="text-blue-600 hover:underline">Privacy Policy</Link>
          </p>

          <div className="mt-6 text-center text-sm text-gray-600">
            Already have an account?{' '}
            <Link href={`/auth/login?redirect=${redirectTo}`} className="text-blue-600 hover:underline font-medium">
              Sign in
            </Link>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}
```

---

### Create **`src/app/auth/callback/route.ts`** (for email confirmation):

```typescript
import { createClient } from '@/lib/supabase/server';
import { NextResponse } from 'next/server';

export async function GET(request: Request) {
  const requestUrl = new URL(request.url);
  const code = requestUrl.searchParams.get('code');

  if (code) {
    const supabase = await createClient();
    await supabase.auth.exchangeCodeForSession(code);
  }

  // Redirect to dashboard after email confirmation
  return NextResponse.redirect(new URL('/dashboard', requestUrl.origin));
}
```

---

## Task 4: User Dashboard (My CVs)

Create **`src/app/dashboard/page.tsx`**:

```tsx
'use client';

import { useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';
import Link from 'next/link';
import { useAuth } from '@/lib/auth/context';
import { createClient } from '@/lib/supabase/client';
import { Button } from '@/components/ui/button';
import { Card, CardContent } from '@/components/ui/card';
import { TemplatePreview } from '@/components/templates/preview';

interface CVWithPayment {
  id: string;
  title: string | null;
  template_id: string;
  data: any;
  status: string;
  created_at: string;
  updated_at: string;
  download_count: number;
  payments: Array<{
    status: string;
    completed_at: string | null;
  }>;
}

export default function DashboardPage() {
  const router = useRouter();
  const { user, profile, isLoading: authLoading, signOut } = useAuth();
  const [cvs, setCVs] = useState<CVWithPayment[]>([]);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    if (!authLoading && !user) {
      router.push('/auth/login?redirect=/dashboard');
    }
  }, [authLoading, user, router]);

  useEffect(() => {
    const fetchCVs = async () => {
      if (!user) return;

      const supabase = createClient();
      const { data, error } = await supabase
        .from('cvs')
        .select(`
          *,
          payments (status, completed_at)
        `)
        .eq('user_id', user.id)
        .eq('is_deleted', false)
        .order('updated_at', { ascending: false });

      if (error) {
        console.error('Error fetching CVs:', error);
      } else {
        setCVs(data || []);
      }
      setIsLoading(false);
    };

    if (user) {
      fetchCVs();
    }
  }, [user]);

  const handleDownload = async (cvId: string) => {
    // Check if CV is paid
    const cv = cvs.find(c => c.id === cvId);
    const isPaid = cv?.payments?.some(p => p.status === 'completed');

    if (isPaid) {
      // Free download for paid CVs
      window.location.href = `/api/pdf/generate?cvId=${cvId}`;
    } else {
      // Redirect to payment
      router.push(`/payment?cvId=${cvId}`);
    }
  };

  const handleEdit = (cvId: string) => {
    router.push(`/builder?cvId=${cvId}`);
  };

  const handleDelete = async (cvId: string) => {
    if (!confirm('Are you sure you want to delete this CV?')) return;

    const supabase = createClient();
    await supabase
      .from('cvs')
      .update({ is_deleted: true })
      .eq('id', cvId);

    setCVs(cvs.filter(cv => cv.id !== cvId));
  };

  if (authLoading || isLoading) {
    return (
      <div className="min-h-screen bg-gray-50 flex items-center justify-center">
        <div className="animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full" />
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Header */}
      <header className="bg-white border-b sticky top-0 z-10">
        <div className="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
          <Link href="/" className="flex items-center gap-2">
            <span className="text-xl">üìÑ</span>
            <span className="text-lg font-bold text-blue-600">CV Chap Chap</span>
          </Link>

          <div className="flex items-center gap-4">
            <span className="text-sm text-gray-600">
              {profile?.full_name || profile?.email}
            </span>
            <Button variant="outline" size="sm" onClick={signOut}>
              Sign Out
            </Button>
          </div>
        </div>
      </header>

      {/* Main Content */}
      <main className="max-w-7xl mx-auto px-4 py-8">
        <div className="flex items-center justify-between mb-8">
          <div>
            <h1 className="text-2xl font-bold text-gray-900">My CVs</h1>
            <p className="text-gray-600 mt-1">
              {cvs.length === 0 
                ? "You haven't created any CVs yet" 
                : `You have ${cvs.length} CV${cvs.length > 1 ? 's' : ''}`
              }
            </p>
          </div>
          <Button onClick={() => router.push('/template')} className="bg-blue-600 hover:bg-blue-700">
            + Create New CV
          </Button>
        </div>

        {cvs.length === 0 ? (
          <Card className="p-12 text-center">
            <div className="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <span className="text-4xl">üìÑ</span>
            </div>
            <h2 className="text-xl font-semibold text-gray-900 mb-2">
              Create Your First CV
            </h2>
            <p className="text-gray-600 mb-6 max-w-md mx-auto">
              Choose from 21 professional templates, fill in your details, 
              and download your polished CV in minutes.
            </p>
            <Button onClick={() => router.push('/template')} size="lg" className="bg-blue-600 hover:bg-blue-700">
              Get Started ‚Üí
            </Button>
          </Card>
        ) : (
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {cvs.map((cv) => {
              const isPaid = cv.payments?.some(p => p.status === 'completed');
              const cvTitle = cv.title || `${cv.data?.personalInfo?.firstName || 'Untitled'}'s CV`;

              return (
                <Card key={cv.id} className="overflow-hidden group">
                  {/* Mini Preview */}
                  <div className="relative aspect-[210/297] bg-gray-100 overflow-hidden">
                    <div 
                      className="absolute top-0 left-0 pointer-events-none"
                      style={{ 
                        transform: 'scale(0.25)', 
                        transformOrigin: 'top left',
                        width: '210mm',
                        height: '297mm',
                      }}
                    >
                      <TemplatePreview
                        templateId={cv.template_id}
                        data={cv.data}
                        scale={1}
                      />
                    </div>

                    {/* Status Badge */}
                    <div className="absolute top-3 right-3">
                      {isPaid ? (
                        <span className="bg-green-500 text-white text-xs px-2 py-1 rounded-full font-medium">
                          ‚úì Owned
                        </span>
                      ) : (
                        <span className="bg-yellow-500 text-white text-xs px-2 py-1 rounded-full font-medium">
                          Draft
                        </span>
                      )}
                    </div>

                    {/* Hover Actions */}
                    <div className="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-3">
                      <Button 
                        size="sm" 
                        variant="secondary"
                        onClick={() => handleEdit(cv.id)}
                      >
                        ‚úèÔ∏è Edit
                      </Button>
                      <Button 
                        size="sm"
                        onClick={() => handleDownload(cv.id)}
                        className={isPaid ? 'bg-green-600 hover:bg-green-700' : 'bg-blue-600 hover:bg-blue-700'}
                      >
                        {isPaid ? '‚¨áÔ∏è Download' : 'üí≥ Pay & Download'}
                      </Button>
                    </div>
                  </div>

                  {/* CV Info */}
                  <CardContent className="p-4">
                    <h3 className="font-semibold text-gray-900 truncate">{cvTitle}</h3>
                    <p className="text-sm text-gray-500 mt-1">
                      Updated {new Date(cv.updated_at).toLocaleDateString()}
                    </p>
                    {isPaid && cv.download_count > 0 && (
                      <p className="text-xs text-gray-400 mt-1">
                        Downloaded {cv.download_count} time{cv.download_count > 1 ? 's' : ''}
                      </p>
                    )}

                    {/* Actions Row */}
                    <div className="flex items-center justify-between mt-4 pt-4 border-t">
                      <button 
                        onClick={() => handleEdit(cv.id)}
                        className="text-sm text-blue-600 hover:underline"
                      >
                        Edit
                      </button>
                      <button 
                        onClick={() => handleDelete(cv.id)}
                        className="text-sm text-red-500 hover:underline"
                      >
                        Delete
                      </button>
                    </div>
                  </CardContent>
                </Card>
              );
            })}
          </div>
        )}
      </main>
    </div>
  );
}
```

---

## Task 5: Protected Route Middleware

Update **`src/middleware.ts`**:

```typescript
import { createServerClient, type CookieOptions } from '@supabase/ssr';
import { NextResponse, type NextRequest } from 'next/server';

export async function middleware(request: NextRequest) {
  let response = NextResponse.next({
    request: {
      headers: request.headers,
    },
  });

  const supabase = createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        get(name: string) {
          return request.cookies.get(name)?.value;
        },
        set(name: string, value: string, options: CookieOptions) {
          request.cookies.set({ name, value, ...options });
          response = NextResponse.next({
            request: { headers: request.headers },
          });
          response.cookies.set({ name, value, ...options });
        },
        remove(name: string, options: CookieOptions) {
          request.cookies.set({ name, value: '', ...options });
          response = NextResponse.next({
            request: { headers: request.headers },
          });
          response.cookies.set({ name, value: '', ...options });
        },
      },
    }
  );

  const { data: { session } } = await supabase.auth.getSession();

  // Protected routes that require authentication
  const protectedRoutes = ['/dashboard', '/profile', '/settings'];
  const isProtectedRoute = protectedRoutes.some(route => 
    request.nextUrl.pathname.startsWith(route)
  );

  if (isProtectedRoute && !session) {
    const redirectUrl = new URL('/auth/login', request.url);
    redirectUrl.searchParams.set('redirect', request.nextUrl.pathname);
    return NextResponse.redirect(redirectUrl);
  }

  // Admin routes
  const adminRoutes = ['/admin'];
  const isAdminRoute = adminRoutes.some(route => 
    request.nextUrl.pathname.startsWith(route)
  );

  if (isAdminRoute) {
    if (!session) {
      return NextResponse.redirect(new URL('/auth/login', request.url));
    }

    // Check if user is admin
    const { data: profile } = await supabase
      .from('profiles')
      .select('role')
      .eq('id', session.user.id)
      .single();

    if (profile?.role !== 'admin') {
      return NextResponse.redirect(new URL('/dashboard', request.url));
    }
  }

  // Redirect logged-in users away from auth pages
  const authRoutes = ['/auth/login', '/auth/register'];
  const isAuthRoute = authRoutes.some(route => 
    request.nextUrl.pathname.startsWith(route)
  );

  if (isAuthRoute && session) {
    return NextResponse.redirect(new URL('/dashboard', request.url));
  }

  return response;
}

export const config = {
  matcher: [
    '/dashboard/:path*',
    '/profile/:path*',
    '/settings/:path*',
    '/admin/:path*',
    '/auth/:path*',
  ],
};
```

---

## Task 6: Add Auth Provider to Layout

Update **`src/app/layout.tsx`**:

```tsx
import type { Metadata } from 'next';
import { Inter } from 'next/font/google';
import './globals.css';
import { AuthProvider } from '@/lib/auth/context';

const inter = Inter({ subsets: ['latin'] });

export const metadata: Metadata = {
  title: 'CV Chap Chap - Create Professional CVs in Minutes',
  description: 'Build stunning CVs with AI-powered suggestions. 21 professional templates, instant PDF download. Made for Tanzania.',
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en">
      <body className={inter.className}>
        <AuthProvider>
          {children}
        </AuthProvider>
      </body>
    </html>
  );
}
```

---

## Task 7: Admin Foundation

Create **`src/app/admin/page.tsx`**:

```tsx
'use client';

import { useEffect, useState } from 'react';
import { useAuth } from '@/lib/auth/context';
import { createClient } from '@/lib/supabase/client';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';

interface DashboardStats {
  totalUsers: number;
  totalCVs: number;
  totalPaidCVs: number;
  totalRevenue: number;
  recentPayments: Array<{
    id: string;
    amount: number;
    status: string;
    created_at: string;
    cv: { data: any };
  }>;
}

export default function AdminDashboard() {
  const { profile, signOut } = useAuth();
  const [stats, setStats] = useState<DashboardStats | null>(null);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    const fetchStats = async () => {
      const supabase = createClient();

      // Fetch counts
      const [usersRes, cvsRes, paymentsRes] = await Promise.all([
        supabase.from('profiles').select('id', { count: 'exact', head: true }),
        supabase.from('cvs').select('id', { count: 'exact', head: true }),
        supabase.from('payments').select('*').eq('status', 'completed'),
      ]);

      const totalRevenue = (paymentsRes.data || []).reduce(
        (sum, p) => sum + (p.amount || 0), 
        0
      );

      // Recent payments
      const { data: recentPayments } = await supabase
        .from('payments')
        .select('*, cvs(data)')
        .order('created_at', { ascending: false })
        .limit(10);

      setStats({
        totalUsers: usersRes.count || 0,
        totalCVs: cvsRes.count || 0,
        totalPaidCVs: paymentsRes.data?.length || 0,
        totalRevenue,
        recentPayments: recentPayments || [],
      });
      setIsLoading(false);
    };

    fetchStats();
  }, []);

  if (isLoading) {
    return (
      <div className="min-h-screen bg-gray-100 flex items-center justify-center">
        <div className="animate-spin w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full" />
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-100">
      {/* Admin Header */}
      <header className="bg-gray-900 text-white">
        <div className="max-w-7xl mx-auto px-4 py-4 flex items-center justify-between">
          <div className="flex items-center gap-4">
            <span className="text-xl">üìÑ</span>
            <span className="text-lg font-bold">CV Chap Chap</span>
            <span className="bg-red-500 text-xs px-2 py-1 rounded">ADMIN</span>
          </div>
          <div className="flex items-center gap-4">
            <span className="text-sm text-gray-300">{profile?.email}</span>
            <button onClick={signOut} className="text-sm text-gray-400 hover:text-white">
              Sign Out
            </button>
          </div>
        </div>
      </header>

      {/* Dashboard Content */}
      <main className="max-w-7xl mx-auto px-4 py-8">
        <h1 className="text-2xl font-bold text-gray-900 mb-6">Admin Dashboard</h1>

        {/* Stats Cards */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
          <Card>
            <CardHeader className="pb-2">
              <CardTitle className="text-sm text-gray-500">Total Users</CardTitle>
            </CardHeader>
            <CardContent>
              <p className="text-3xl font-bold">{stats?.totalUsers || 0}</p>
            </CardContent>
          </Card>

          <Card>
            <CardHeader className="pb-2">
              <CardTitle className="text-sm text-gray-500">Total CVs</CardTitle>
            </CardHeader>
            <CardContent>
              <p className="text-3xl font-bold">{stats?.totalCVs || 0}</p>
            </CardContent>
          </Card>

          <Card>
            <CardHeader className="pb-2">
              <CardTitle className="text-sm text-gray-500">Paid CVs</CardTitle>
            </CardHeader>
            <CardContent>
              <p className="text-3xl font-bold text-green-600">{stats?.totalPaidCVs || 0}</p>
            </CardContent>
          </Card>

          <Card>
            <CardHeader className="pb-2">
              <CardTitle className="text-sm text-gray-500">Total Revenue</CardTitle>
            </CardHeader>
            <CardContent>
              <p className="text-3xl font-bold text-green-600">
                TZS {(stats?.totalRevenue || 0).toLocaleString()}
              </p>
            </CardContent>
          </Card>
        </div>

        {/* Recent Payments */}
        <Card>
          <CardHeader>
            <CardTitle>Recent Payments</CardTitle>
          </CardHeader>
          <CardContent>
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead>
                  <tr className="text-left text-sm text-gray-500 border-b">
                    <th className="pb-3 font-medium">Customer</th>
                    <th className="pb-3 font-medium">Amount</th>
                    <th className="pb-3 font-medium">Status</th>
                    <th className="pb-3 font-medium">Date</th>
                  </tr>
                </thead>
                <tbody>
                  {stats?.recentPayments.map((payment) => (
                    <tr key={payment.id} className="border-b last:border-0">
                      <td className="py-3">
                        {payment.cv?.data?.personalInfo?.firstName || 'Anonymous'}{' '}
                        {payment.cv?.data?.personalInfo?.lastName || ''}
                      </td>
                      <td className="py-3">TZS {payment.amount.toLocaleString()}</td>
                      <td className="py-3">
                        <span className={`px-2 py-1 rounded-full text-xs ${
                          payment.status === 'completed' 
                            ? 'bg-green-100 text-green-700' 
                            : 'bg-yellow-100 text-yellow-700'
                        }`}>
                          {payment.status}
                        </span>
                      </td>
                      <td className="py-3 text-sm text-gray-500">
                        {new Date(payment.created_at).toLocaleDateString()}
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </CardContent>
        </Card>
      </main>
    </div>
  );
}
```

---

## Task 8: Update Header Component for Auth

Create **`src/components/layout/header.tsx`**:

```tsx
'use client';

import Link from 'next/link';
import { useAuth } from '@/lib/auth/context';
import { Button } from '@/components/ui/button';

export function Header() {
  const { user, profile, isLoading, signOut } = useAuth();

  return (
    <header className="bg-white border-b sticky top-0 z-50">
      <div className="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
        {/* Logo */}
        <Link href="/" className="flex items-center gap-2">
          <span className="text-2xl">üìÑ</span>
          <span className="text-xl font-bold">
            <span className="text-gray-900">CV</span>
            <span className="text-blue-600"> Chap Chap</span>
          </span>
        </Link>

        {/* Navigation */}
        <nav className="hidden md:flex items-center gap-6">
          <Link href="/#features" className="text-gray-600 hover:text-gray-900">
            Features
          </Link>
          <Link href="/template" className="text-gray-600 hover:text-gray-900">
            Templates
          </Link>
          <Link href="/#how-it-works" className="text-gray-600 hover:text-gray-900">
            How It Works
          </Link>
          <Link href="/#pricing" className="text-gray-600 hover:text-gray-900">
            Pricing
          </Link>
        </nav>

        {/* Auth Buttons */}
        <div className="flex items-center gap-3">
          {isLoading ? (
            <div className="w-8 h-8 animate-pulse bg-gray-200 rounded" />
          ) : user ? (
            <>
              <Link href="/dashboard" className="text-gray-600 hover:text-gray-900">
                My CVs
              </Link>
              <div className="relative group">
                <button className="flex items-center gap-2 text-sm text-gray-600">
                  <span className="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-medium">
                    {profile?.full_name?.charAt(0) || user.email?.charAt(0)?.toUpperCase()}
                  </span>
                </button>
                {/* Dropdown */}
                <div className="absolute right-0 top-full mt-2 w-48 bg-white rounded-lg shadow-lg border opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all">
                  <div className="p-3 border-b">
                    <p className="font-medium text-sm truncate">{profile?.full_name || 'User'}</p>
                    <p className="text-xs text-gray-500 truncate">{user.email}</p>
                  </div>
                  <Link href="/dashboard" className="block px-3 py-2 text-sm hover:bg-gray-50">
                    My CVs
                  </Link>
                  <Link href="/profile" className="block px-3 py-2 text-sm hover:bg-gray-50">
                    Profile Settings
                  </Link>
                  {profile?.role === 'admin' && (
                    <Link href="/admin" className="block px-3 py-2 text-sm text-red-600 hover:bg-gray-50">
                      Admin Dashboard
                    </Link>
                  )}
                  <button 
                    onClick={signOut}
                    className="w-full text-left px-3 py-2 text-sm text-gray-600 hover:bg-gray-50 border-t"
                  >
                    Sign Out
                  </button>
                </div>
              </div>
            </>
          ) : (
            <>
              <Link href="/auth/login" className="text-gray-600 hover:text-gray-900">
                Login
              </Link>
              <Button asChild className="bg-blue-600 hover:bg-blue-700">
                <Link href="/template">Create CV Free</Link>
              </Button>
            </>
          )}
        </div>
      </div>
    </header>
  );
}
```

---

## Summary: Files to Create

| File | Purpose |
|------|---------|
| `src/lib/auth/context.tsx` | Auth context provider |
| `src/app/auth/login/page.tsx` | Login page |
| `src/app/auth/register/page.tsx` | Registration page |
| `src/app/auth/callback/route.ts` | Email confirmation handler |
| `src/app/dashboard/page.tsx` | User's CV dashboard |
| `src/app/admin/page.tsx` | Admin dashboard |
| `src/components/layout/header.tsx` | Auth-aware header |
| `src/middleware.ts` | Route protection |

## Database Changes (SQL)
- Add `role` column to profiles
- Add user sessions table
- Add admin audit log table
- Add RLS policies for security
- Add helper functions

---

## Testing Checklist

1. **Sign Up Flow**
   - [ ] User can register with email/password
   - [ ] Confirmation email is sent
   - [ ] Profile is created automatically

2. **Sign In Flow**
   - [ ] User can login with email/password
   - [ ] Anonymous CVs are claimed on login
   - [ ] Redirect to intended page after login

3. **Dashboard**
   - [ ] Shows all user's CVs
   - [ ] Paid CVs show "Owned" badge
   - [ ] Can edit/delete CVs
   - [ ] Free download for paid CVs

4. **Admin**
   - [ ] Only admin role can access /admin
   - [ ] Shows stats: users, CVs, revenue
   - [ ] Shows recent payments

---

**Once the engineer implements this, you'll have:**
- ‚úÖ Complete auth system (signup, login, logout)
- ‚úÖ User dashboard showing their CVs
- ‚úÖ CV ownership (paid CVs = free forever)
- ‚úÖ Admin foundation for revenue tracking
- ‚úÖ Protected routes with proper redirects